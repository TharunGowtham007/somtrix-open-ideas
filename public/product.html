<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SOMTRIX™ — Product</title>
<style>
  :root{--bg:#f4f7fb;--card:#fff;--accent:#7F8CBD;--muted:#6c7689;--radius:12px;--shadow:0 10px 30px rgba(16,25,40,0.06);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  body{margin:0;background:linear-gradient(145deg,#eef2fb 0,#dfe7ff 40%,#f4f7fb 100%);color:#111}
  .wrap{max-width:980px;margin:18px auto;padding:16px}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
  .brand{display:flex;gap:12px;align-items:center}
  .brand img{width:52px;height:52px;border-radius:50%}
  .title{font-size:20px;margin:0}
  .grid{display:grid;grid-template-columns:1fr 320px;gap:12px}
  .card{background:var(--card);padding:12px;border-radius:var(--radius);box-shadow:var(--shadow)}
  .gallery{display:flex;gap:8px;flex-wrap:wrap}
  .gallery img{width:100%;max-height:320px;object-fit:cover;border-radius:8px}
  .updates{margin-top:12px;display:flex;flex-direction:column;gap:10px}
  .update{border-radius:8px;padding:10px;background:#fbfcff;border:1px solid #e8eefb}
  @media(max-width:900px){ .grid{grid-template-columns:1fr} .gallery img{max-height:220px} }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand"><img src="logo.png" alt="logo" onerror="this.style.display='none'"><h1 class="title">SOMTRIX™ — Product details</h1></div>
      <nav><a href="products.html">Products</a> · <a href="vote.html">Ideas</a></nav>
    </header>

    <div class="grid">
      <div class="card" id="main-col">
        <div id="product-area">Loading product…</div>
        <div id="updates-area"></div>
      </div>

      <aside class="card">
        <h3 id="aside-name">—</h3>
        <div id="aside-meta" style="color:var(--muted);font-size:13px"></div>
        <div id="aside-price" style="margin-top:10px;font-weight:700"></div>
      </aside>
    </div>
  </div>

<script>
const API_BASE = '';
function qs(key){ const u=new URL(location.href); return u.searchParams.get(key); }

async function loadProduct(){
  const id = qs('id');
  if(!id){ document.getElementById('product-area').innerHTML = '<div style="color:#b00">Missing product id.</div>'; return; }
  try{
    const res = await fetch(`${API_BASE}/api/products/${id}`);
    if(!res.ok) throw new Error('Failed to load');
    const json = await res.json();
    const p = json.product;
    const updates = json.updates || [];

    document.getElementById('aside-name').textContent = p.name;
    document.getElementById('aside-meta').textContent = p.creator || '';
    document.getElementById('aside-price').textContent = p.price ? 'Price: '+p.price : '';

    const area = document.getElementById('product-area');
    const imgs = (p.images || []);
    let galleryHtml = '';
    if(imgs.length){
      galleryHtml = '<div class="gallery">'+imgs.map(i=>`<img src="${i}" alt="">`).join('')+'</div>';
    }
    area.innerHTML = `<h2 style="margin:0">${escapeHtml(p.name)}</h2>
                      <div style="color:var(--muted);margin-top:6px">${escapeHtml(p.description || '')}</div>
                      ${galleryHtml}`;

    const ua = document.getElementById('updates-area');
    ua.innerHTML = '<h3 style="margin-top:14px">Updates</h3>';
    if(!updates.length) ua.innerHTML += '<div style="color:#666">No updates yet.</div>';
    updates.forEach(u=>{
      const div = document.createElement('div'); div.className='update';
      const imgsHtml = (u.images||[]).map(i=>`<img src="${i}" style="max-width:100%;display:block;margin-top:8px;border-radius:6px">`).join('');
      div.innerHTML = `<div style="font-weight:700">${escapeHtml(u.title)}</div>
                       <div style="color:var(--muted);font-size:13px;margin-top:6px">${escapeHtml(u.body)}</div>
                       ${imgsHtml}
                       <div style="font-size:11px;color:#999;margin-top:6px">${escapeHtml(u.created_at)}</div>`;
      ua.appendChild(div);
    });

  }catch(e){
    console.error(e);
    document.getElementById('product-area').innerHTML = '<div style="color:#b00">Failed to load product.</div>';
  }
}
function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

document.addEventListener('DOMContentLoaded', loadProduct);
</script>
</body>
</html>
